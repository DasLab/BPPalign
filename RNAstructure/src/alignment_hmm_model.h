#ifndef _ALN_HMM_MODEL_
#define _ALN_HMM_MODEL_

// This file defines the hmm model for alignment hmm model.
// This file is only for alignment hmm model, the hmm model 
// is a pairwise alignment model where 3 states can output 
// 2 sequence symbols (nucleotides) or gaps. 
#define N_STATES (3)
#define N_OUTPUTS (27)
#define N_BINZ (10)

// All alignment HMM dependent code goes here.

enum {STATE_INS1, STATE_INS2, STATE_ALN};
static char state_names[N_STATES][10] = {"// INS1", "// INS2", "// ALIGN"};

void load_fam_hmm_parameters(char* fam_par_file_name);

// It can take the sequences that are loaded at hand to determine the hmm parameters to use.
// These parameters are imported from header file written from training.
void choose_hmm_parameters(double similarity);

// Following function sets a set of transition and emission probabilities to emit_probs and trans_probs.
void set_hmm_parameters(double emit_probs[N_OUTPUTS][N_STATES], double trans_probs[N_STATES][N_STATES]);

double get_fam_threshold(double similarity);

int get_bin_index(double similarity, int n_bins);

/*
// Following are hmm parameters from ssu rrna set fromn RFAM.
static double emit_probs[N_OUTPUTS][N_STATES] = 
{
	{0.000, 0.000, 0.162 },
	{0.000, 0.000, 0.031 },
	{0.000, 0.000, 0.038 },
	{0.000, 0.000, 0.038 },
	{0.276, 0.000, 0.000 },
	{0.000, 0.000, 0.037 },
	{0.000, 0.000, 0.113 },
	{0.000, 0.000, 0.034 },
	{0.000, 0.000, 0.047 },
	{0.199, 0.000, 0.000 },
	{0.000, 0.000, 0.055 },
	{0.000, 0.000, 0.040 },
	{0.000, 0.000, 0.159 },
	{0.000, 0.000, 0.042 },
	{0.280, 0.000, 0.000 },
	{0.000, 0.000, 0.035 },
	{0.000, 0.000, 0.036 },
	{0.000, 0.000, 0.029 },
	{0.000, 0.000, 0.104 },
	{0.245, 0.000, 0.000 },
	{0.000, 0.284, 0.000 },
	{0.000, 0.200, 0.000 },
	{0.000, 0.239, 0.000 },
	{0.000, 0.277, 0.000 },
	{0.000, 0.000, 0.000 },
	{0.000, 0.000, 1.000 }
};

static double trans_probs[N_STATES][N_STATES] = 
{
	{0.870, 0.017, 0.113}, 
	{0.020, 0.844, 0.136}, 
	{0.033, 0.033, 0.933}
};
*/
/*
// Following is the emission& transition parameters with 5s rna trained model, with
// corrected match probabilities.
static double emit_probs[N_OUTPUTS][N_STATES] = 
{
	{0.000 ,0.000 ,0.1655 }, //aa
	{0.000 ,0.000 ,0.028 }, //ac
	{0.000 ,0.000 ,0.028 }, //ag
	{0.000 ,0.000 ,0.028 }, //au
	{0.201 ,0.000 ,0.000 }, //a.
	{0.000 ,0.000 ,0.028 }, //ca
	{0.000 ,0.000 ,0.1655 }, //cc
	{0.000 ,0.000 ,0.028 }, //cg
	{0.000 ,0.000 ,0.028 }, //cu
	{0.2295 ,0.000 ,0.000 }, //c.
	{0.000 ,0.000 ,0.028 }, //ga
	{0.000 ,0.000 ,0.028 }, //gc
	{0.000 ,0.000 ,0.1655 }, //gg
	{0.000 ,0.000 ,0.028 }, //gu
	{0.313 ,0.000 ,0.000 }, //g.
	{0.000 ,0.000 ,0.028 }, //ua
	{0.000 ,0.000 ,0.028 }, //uc
	{0.000 ,0.000 ,0.028 }, //ug
	{0.000 ,0.000 ,0.1655 }, //uu
	{0.2565 ,0.000 ,0.000 }, //u.
	{0.000 ,0.201 ,0.000 }, //.a
	{0.000 ,0.2295 ,0.000 }, //.c
	{0.000 ,0.313 ,0.000 }, //.g
	{0.000 ,0.2565 ,0.000 }, //.u
	{0.000 ,0.000 ,0.000 }, //..
	{0.000 ,0.000 ,1.000 },  //end_symbol
	{0.000 ,0.000 ,1.000 }  //begin_symbol
};

static double trans_probs[N_STATES][N_STATES] = 
{
	{0.3835, 0.1045, 0.512 },
	{0.1045, 0.3835, 0.512 },
	{0.016,  0.016 , 0.968 }
};
*/

// Following are the parameters trained with 10 full families.
// Following parameters are used for ML calculation. They should be loaded.
static double ML_emit_probs[N_OUTPUTS][N_STATES] = 
{
	{0.000000, 0.000000, 0.134009}, // AA
	{0.000000, 0.000000, 0.027164}, // AC
	{0.000000, 0.000000, 0.049659}, // AG
	{0.000000, 0.000000, 0.028825}, // AU
	{0.211509, 0.000000, 0.000000}, // A.
	{0.000000, 0.000000, 0.027164}, // CA
	{0.000000, 0.000000, 0.140242}, // CC
	{0.000000, 0.000000, 0.037862}, // CG
	{0.000000, 0.000000, 0.047735}, // CU
	{0.257349, 0.000000, 0.000000}, // C.
	{0.000000, 0.000000, 0.049659}, // GA
	{0.000000, 0.000000, 0.037862}, // GC
	{0.000000, 0.000000, 0.178863}, // GG
	{0.000000, 0.000000, 0.032351}, // GU
	{0.271398, 0.000000, 0.000000}, // G.
	{0.000000, 0.000000, 0.028825}, // UA
	{0.000000, 0.000000, 0.047735}, // UC
	{0.000000, 0.000000, 0.032351}, // UG
	{0.000000, 0.000000, 0.099694}, // UU
	{0.259744, 0.000000, 0.000000}, // U.
	{0.000000, 0.211509, 0.000000}, // .A
	{0.000000, 0.257349, 0.000000}, // .C
	{0.000000, 0.271398, 0.000000}, // .G
	{0.000000, 0.259744, 0.000000}, // .U
	{0.000000, 0.000000, 0.000000}, // ..
	{0.000000, 0.000000, 1.000000}, // START
	{0.000000, 0.000000, 1.000000}  // END
};

static double ML_trans_probs[N_STATES][N_STATES] = 
{
	{0.666439, 0.041319, 0.292242}, // INS1
	{0.041319, 0.666439, 0.292242}, // INS2
	{0.022666, 0.022666, 0.954668}  // ALIGN
};

/*
// Following is training parameters from trna and 5s rna training from half random RFAM seed alignments.
static double emit_probs[N_OUTPUTS][N_STATES] = 
{
	{0.000000, 0.000000, 0.121887},
	{0.000000, 0.000000, 0.029840},
	{0.000000, 0.000000, 0.053708},
	{0.000000, 0.000000, 0.038863},
	{0.179243, 0.000000, 0.000000},
	{0.000000, 0.000000, 0.033618},
	{0.000000, 0.000000, 0.111403},
	{0.000000, 0.000000, 0.036306},
	{0.000000, 0.000000, 0.056978},
	{0.219361, 0.000000, 0.000000},
	{0.000000, 0.000000, 0.063899},
	{0.000000, 0.000000, 0.036903},
	{0.000000, 0.000000, 0.136949},
	{0.000000, 0.000000, 0.041344},
	{0.220235, 0.000000, 0.000000},
	{0.000000, 0.000000, 0.040005},
	{0.000000, 0.000000, 0.050228},
	{0.000000, 0.000000, 0.035300},
	{0.000000, 0.000000, 0.112770},
	{0.381162, 0.000000, 0.000000},
	{0.000000, 0.187479, 0.000000},
	{0.000000, 0.234454, 0.000000},
	{0.000000, 0.223223, 0.000000},
	{0.000000, 0.354844, 0.000000},
	{0.000000, 0.000000, 0.000000},
	{0.000000, 0.000000, 1.000000},
	{0.000000, 0.000000, 1.000000}
};

static double trans_probs[N_STATES][N_STATES] = 
{
	{0.534878, 0.045031, 0.420091},
	{0.064410, 0.469477, 0.466113},
	{0.021761, 0.017967, 0.960272}
};
*/
/*
// Following is CONSTRAINED training parameters from trna and 5s rna training 
// from half random RFAM seed alignments.
static double emit_probs[N_OUTPUTS][N_STATES] = 
{
	{0.000000, 0.000000, 0.121887}, // aa
	{0.000000, 0.000000, 0.029840}, // ac
	{0.000000, 0.000000, 0.053708}, // ag 
	{0.000000, 0.000000, 0.038863}, // au
	{0.179243, 0.000000, 0.000000}, // a.
	{0.000000, 0.000000, 0.033618}, // ga
	{0.000000, 0.000000, 0.111403}, // gc 
	{0.000000, 0.000000, 0.036306}, // gg
	{0.000000, 0.000000, 0.056978}, // gu
	{0.219361, 0.000000, 0.000000}, // g.
	{0.000000, 0.000000, 0.063899}, // ca
	{0.000000, 0.000000, 0.036903}, // cc
	{0.000000, 0.000000, 0.136949}, // cg
	{0.000000, 0.000000, 0.041344}, // cu
	{0.220235, 0.000000, 0.000000}, // c.
	{0.000000, 0.000000, 0.040005}, // ca
	{0.000000, 0.000000, 0.050228}, // uc
	{0.000000, 0.000000, 0.035300}, // ug
	{0.000000, 0.000000, 0.112770}, // uu
	{0.381162, 0.000000, 0.000000}, // u.
	{0.000000, 0.187479, 0.000000}, // .a
	{0.000000, 0.234454, 0.000000}, // .c
	{0.000000, 0.223223, 0.000000}, // .g
	{0.000000, 0.354844, 0.000000}, // .u
	{0.000000, 0.000000, 0.000000}, // ..
	{0.000000, 0.000000, 1.000000}, // END
	{0.000000, 0.000000, 1.000000}  // START
};

static double trans_probs[N_STATES][N_STATES] = 
{
	{0.534878, 0.045031, 0.420091},
	{0.064410, 0.469477, 0.466113},
	{0.021761, 0.017967, 0.960272}
};
*/
/*
// Following is CONSTRAINED training parameters from trna and 5s rna training from half random RFAM seed alignments.
static double emit_probs[N_OUTPUTS][N_STATES] = 
{
	{0.000000, 0.000000, 0.1203}, // AA
	{0.000000, 0.000000, 0.0432}, // AC
	{0.000000, 0.000000, 0.0432}, // AG
	{0.000000, 0.000000, 0.0432}, // AU
	{0.25, 0.000000, 0.000000}, // A.
	{0.000000, 0.000000, 0.0432}, // CA
	{0.000000, 0.000000, 0.1203}, // CC
	{0.000000, 0.000000, 0.0432}, // CG
	{0.000000, 0.000000, 0.0432}, // CU
	{0.25, 0.000000, 0.000000}, // C.
	{0.000000, 0.000000, 0.0432}, // GA
	{0.000000, 0.000000, 0.0432}, // GC
	{0.000000, 0.000000, 0.1203}, // GG
	{0.000000, 0.000000, 0.0432}, // GU
	{0.25, 0.000000, 0.000000}, // G.
	{0.000000, 0.000000, 0.0432}, // UA
	{0.000000, 0.000000, 0.0432}, // UC
	{0.000000, 0.000000, 0.0432}, // UG
	{0.000000, 0.000000, 0.1203}, // UU
	{0.25, 0.000000, 0.000000}, // U.
	{0.000000, 0.25, 0.000000}, // .A
	{0.000000, 0.25, 0.000000}, // .C
	{0.000000, 0.25, 0.000000}, // .G
	{0.000000, 0.25, 0.000000}, // .U
	{0.000000, 0.000000, 0.000000}, // ..
	{0.000000, 0.000000, 0.100000}, // START
	{0.000000, 0.000000, 0.100000} // END
};

static double trans_probs[N_STATES][N_STATES] = 
{
	{0.510350, 0.052963, 0.436686},
	{0.052963, 0.510350, 0.436686},
	{0.019807, 0.019807, 0.960385}
};
*/
/*
// Bacterial RNase P Class A training.
static double emit_probs[N_OUTPUTS][N_STATES] = 
{
{0.000000, 0.000000, 0.175852 },
{0.000000, 0.000000, 0.021096 },
{0.000000, 0.000000, 0.039421 },
{0.000000, 0.000000, 0.015948 },
{0.227513, 0.000000, 0.000000 },
{0.000000, 0.000000, 0.020877 },
{0.000000, 0.000000, 0.164726 },
{0.000000, 0.000000, 0.033664 },
{0.000000, 0.000000, 0.039112 },
{0.263812, 0.000000, 0.000000 },
{0.000000, 0.000000, 0.039476 },
{0.000000, 0.000000, 0.033900 },
{0.000000, 0.000000, 0.241939 },
{0.000000, 0.000000, 0.023317 },
{0.308191, 0.000000, 0.000000 },
{0.000000, 0.000000, 0.015870 },
{0.000000, 0.000000, 0.039370 },
{0.000000, 0.000000, 0.024735 },
{0.000000, 0.000000, 0.070696 },
{0.200484, 0.000000, 0.000000 },
{0.000000, 0.226906, 0.000000 },
{0.000000, 0.266869, 0.000000 },
{0.000000, 0.306554, 0.000000 },
{0.000000, 0.199672, 0.000000 },
{0.000000, 0.000000, 1.000000 },
{0.000000, 0.000000, 1.000000 }
};

static double trans_probs[N_STATES][N_STATES] = 
{
{0.811161, 0.034020, 0.154819 },
{0.031090, 0.819716, 0.149195 },
{0.031291, 0.028808, 0.939901 }
};
*/
/*
// Following are group 1 intron trained parameters.
static double emit_probs[N_OUTPUTS][N_STATES] = 
{
	{0.000000, 0.000000, 0.182636},
	{0.000000, 0.000000, 0.036718},
	{0.000000, 0.000000, 0.058101},
	{0.000000, 0.000000, 0.073864},
	{0.357815, 0.000000, 0.000000},
	{0.000000, 0.000000, 0.035575},
	{0.000000, 0.000000, 0.063482},
	{0.000000, 0.000000, 0.030289},
	{0.000000, 0.000000, 0.042242},
	{0.147898, 0.000000, 0.000000},
	{0.000000, 0.000000, 0.049576},
	{0.000000, 0.000000, 0.028765},
	{0.000000, 0.000000, 0.085437},
	{0.000000, 0.000000, 0.038718},
	{0.181783, 0.000000, 0.000000},
	{0.000000, 0.000000, 0.070721},
	{0.000000, 0.000000, 0.043242},
	{0.000000, 0.000000, 0.045862},
	{0.000000, 0.000000, 0.114773},
	{0.312505, 0.000000, 0.000000},
	{0.000000, 0.351377, 0.000000},
	{0.000000, 0.151070, 0.000000},
	{0.000000, 0.215952, 0.000000},
	{0.000000, 0.281601, 0.000000},
	{0.000000, 0.000000, 1.000000},
	{0.000000, 0.000000, 1.000000}
};

static double trans_probs[N_STATES][N_STATES] = 
{
	{0.950790, 0.011446, 0.037764},
	{0.012385, 0.936732, 0.050883},
	{0.025065, 0.024495, 0.950440}
};
*/

/*
//Following is the emission& transition parameters with 5s rna trained model.
static double emit_probs[N_OUTPUTS][N_STATES] = 
{
	{0.000 ,0.000 ,0.148 }, //aa
	{0.000 ,0.000 ,0.017 }, //ac
	{0.000 ,0.000 ,0.035 }, //ag
	{0.000 ,0.000 ,0.020 }, //au
	{0.164 ,0.000 ,0.000 }, //a.
	{0.000 ,0.000 ,0.018 }, //ca
	{0.000 ,0.000 ,0.183 }, //cc
	{0.000 ,0.000 ,0.026 }, //cg
	{0.000 ,0.000 ,0.047 }, //cu
	{0.248 ,0.000 ,0.000 }, //c.
	{0.000 ,0.000 ,0.047 }, //ga
	{0.000 ,0.000 ,0.024 }, //gc
	{0.000 ,0.000 ,0.216 }, //gg
	{0.000 ,0.000 ,0.026 }, //gu
	{0.348 ,0.000 ,0.000 }, //g.
	{0.000 ,0.000 ,0.022 }, //ua
	{0.000 ,0.000 ,0.038 }, //uc
	{0.000 ,0.000 ,0.016 }, //ug
	{0.000 ,0.000 ,0.115 }, //uu
	{0.240 ,0.000 ,0.000 }, //u.
	{0.000 ,0.238 ,0.000 }, //.a
	{0.000 ,0.211 ,0.000 }, //.c
	{0.000 ,0.278 ,0.000 }, //.g
	{0.000 ,0.273 ,0.000 }, //.u
	{0.000 ,0.000 ,0.000 }, //..
	{0.000 ,0.000 ,1.000 }  //end_symbol
};

static double trans_probs[N_STATES][N_STATES] = 
{
	{0.433, 0.075, 0.492 },
	{0.134, 0.334, 0.532 },
	{0.022, 0.010, 0.968 }
};
*/
/*
// Following are hmm parameters from RFAM trna data set of 1114 seed tRNA sequences.
static double emit_probs[N_OUTPUTS][N_STATES] = 
{
	{0.000, 0.000, 0.111},
	{0.000, 0.000, 0.031},
	{0.000, 0.000, 0.059}, 
	{0.000, 0.000, 0.041}, 
	{0.167, 0.000, 0.000}, 
	{0.000, 0.000, 0.036}, 
	{0.000, 0.000, 0.094}, 
	{0.000, 0.000, 0.037}, 
	{0.000, 0.000, 0.061}, 
	{0.202, 0.000, 0.000}, 
	{0.000, 0.000, 0.070}, 
	{0.000, 0.000, 0.037}, 
	{0.000, 0.000, 0.125}, 
	{0.000, 0.000, 0.045}, 
	{0.223, 0.000, 0.000}, 
	{0.000, 0.000, 0.042}, 
	{0.000, 0.000, 0.052}, 
	{0.000, 0.000, 0.040}, 
	{0.000, 0.000, 0.120}, 
	{0.408, 0.000, 0.000}, 
	{0.000, 0.191, 0.000}, 
	{0.000, 0.179, 0.000}, 
	{0.000, 0.212, 0.000}, 
	{0.000, 0.418, 0.000}, 
	{0.000, 0.000, 0.000}, 
	{0.000, 0.000, 1.000} 
};

static double trans_probs[N_STATES][N_STATES] = 
{
	{0.563, 0.048, 0.389}, 
	{0.053, 0.592, 0.355}, 
	{0.021, 0.017, 0.963}, 
};

*/
/*
// Following are parameters from RFAM tRNA alignments with hand chosen long ones but they are not very well chosen.
static double trans_probs[N_STATES][N_STATES] = 
{
	{0.371, 0.057, 0.572},
	{0.029, 0.538, 0.433},
	{0.025, 0.024, 0.951}
};

static double emit_probs[N_OUTPUTS][N_STATES] = 
{
	{0.000, 0.000, 0.106 },
	{0.000, 0.000, 0.018 },
	{0.000, 0.000, 0.047 },
	{0.000, 0.000, 0.017 },
	{0.217, 0.000, 0.000 },
	{0.000, 0.000, 0.025 },
	{0.000, 0.000, 0.153 },
	{0.000, 0.000, 0.054 },
	{0.000, 0.000, 0.053 },
	{0.203, 0.000, 0.000 },
	{0.000, 0.000, 0.069 },
	{0.000, 0.000, 0.049 },
	{0.000, 0.000, 0.191 },
	{0.000, 0.000, 0.032 },
	{0.288, 0.000, 0.000 },
	{0.000, 0.000, 0.019 },
	{0.000, 0.000, 0.038 },
	{0.000, 0.000, 0.024 },
	{0.000, 0.000, 0.104 },
	{0.292, 0.000, 0.000 },
	{0.000, 0.240, 0.000 },
	{0.000, 0.212, 0.000 },
	{0.000, 0.297, 0.000 },
	{0.000, 0.250, 0.000 }, 
	{0.000, 0.000, 0.000 }, 
	{0.000, 0.000, 1.000 }
};
*/

// first col is INS1's, second col is INS2's, third col is ALN's emission probs.
/*
static double emit_probs[N_OUTPUTS][N_STATES] = 
{
	{(double)1/24, (double)1/24, (double)1/24}, // 0
	{(double)1/24, (double)1/24, (double)1/24}, // 1
	{(double)1/24, (double)1/24, (double)1/24}, // 2
	{(double)1/24, (double)1/24, (double)1/24}, // 3
	{(double)1/24, (double)1/24, (double)1/24}, // 4
	{(double)1/24, (double)1/24, (double)1/24}, // 5
	{(double)1/24, (double)1/24, (double)1/24}, // 6
	{(double)1/24, (double)1/24, (double)1/24}, // 7
	{(double)1/24, (double)1/24, (double)1/24}, // 8
	{(double)1/24, (double)1/24, (double)1/24}, // 9
	{(double)1/24, (double)1/24, (double)1/24}, // 10
	{(double)1/24, (double)1/24, (double)1/24}, // 11
	{(double)1/24, (double)1/24, (double)1/24}, // 12
	{(double)1/24, (double)1/24, (double)1/24}, // 13
	{(double)1/24, (double)1/24, (double)1/24}, // 14
	{(double)1/24, (double)1/24, (double)1/24}, // 15
	{(double)1/24, (double)1/24, (double)1/24}, // 16
	{(double)1/24, (double)1/24, (double)1/24}, // 17
	{(double)1/24, (double)1/24, (double)1/24}, // 18
	{(double)1/24, (double)1/24, (double)1/24}, // 19
	{(double)1/24, (double)1/24, (double)1/24}, // 20
	{(double)1/24, (double)1/24, (double)1/24}, // 21
	{(double)1/24, (double)1/24, (double)1/24}, // 22
	{(double)1/24, (double)1/24, (double)1/24}, // 23
	{(double)0   , (double)0   , (double)0   }, // 24 -> Emitting gaps at both sequences, impossible.
	{(double)0   , (double)0   , (double)1   }  // 25 -> Emitting ending symbols, only possible for STATE_ALN state.

};
*/

/*
static double trans_probs[N_STATES][N_STATES] = { {1,0,0},
						  {0,1,0},
						  {0,0,1}
							};
*/

#endif
